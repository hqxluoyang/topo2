<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>develop\component\toolBar\toolBar.js - QTopo</title>
  
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="stylesheet" href="../assets/vendor/bootstrap/css/bootstrap.min.css">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
</head>
<body class="yui3-smart">
 <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
        <div class="container-fluid">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
               <a class="navbar-brand mainlogo" href="https://github.com/hai3460377/QTopo">
             
            <img alt="QTopo" src="..\logo.png" title="QTopo">
            
                QTopo
          </a>
            </div>
            <div id="navbar" class="navbar-collapse collapse">
                 <ul class="nav navbar-nav">
                    
                    <li><a href="./index.html">教程</a>
                    </li>
                    
                    <li><a href="./download/qtopo.zip">下载</a>
                    </li>
                    
                </ul>
               <div class="navbar-form navbar-right filterAPi" autocomplete="off">
                <input type="text" id='txtSearchAPI' class="form-control search-query" placeholder="Search for API" />
                 <ul id="filterList" class="filterItems dropdown-menu" role="menu"></ul>
                </div>
            </div>
        </div>
    </nav>
    <div id="sidebar">
    <h3>Modules/Classes</h3>
        <div id="api-tabview-filter">
            <input id='txtSearch' type="search" class="form-control" placeholder="Type to filter Modules/Classes">
        </div>
        <dl id="sidebar_list">
             
                <dt>
                    <span class="glyphicon glyphicon-minus"></span>
                    <a href="../modules/component.html">component</a>
                </dt>
                <dd>
                    <ul>
                   
                       <li>
                            
                           <a href="../classes/rightMenu.html">rightMenu</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/toolBar.html">toolBar</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/windows.html">windows</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                    </ul>
                </dd>
             
                <dt>
                    <span class="glyphicon glyphicon-minus"></span>
                    <a href="../modules/core.html">core</a>
                </dt>
                <dd>
                    <ul>
                   
                       <li>
                            
                           <a href="../classes/[C] Container.html">[C] Container</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/Group.html">Group</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/DirectLine.html">DirectLine</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/[LE] Line.html">[LE] Line</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/CurveLink.html">CurveLink</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/DirectLink.html">DirectLink</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/FlexionalLink.html">FlexionalLink</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/FoldLink.html">FoldLink</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/[L] Link.html">[L] Link</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/ImageNode.html">ImageNode</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/[N] Node.html">[N] Node</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/ShapeNode.html">ShapeNode</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/initTextNode.html">initTextNode</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/[E] Element.html">[E] Element</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/Scene.html">Scene</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                    </ul>
                </dd>
             
                <dt>
                    <span class="glyphicon glyphicon-minus"></span>
                    <a href="../modules/QTopo.html">QTopo</a>
                </dt>
                <dd>
                    <ul>
                   
                       <li>
                            
                           <a href="../classes/QTopo.windowUtil.html">QTopo.windowUtil</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/QTopo.html">QTopo</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/QTopo.instance.html">QTopo.instance</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/QTopo.util.html">QTopo.util</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                    </ul>
                </dd>
             
        </dl>
</div>
   
    <div class="stdoc-content">
        <!--     <form id="options-form" class="form-inline pull-right">
        Show:
        <label for="api-show-inherited" class="checkbox">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected" class="checkbox">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private" class="checkbox">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated" class="checkbox">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </form>

 -->
        <div class="apidocs">
            <div id="docs-main">
                <div class="content">
                    <div class="page-header">
    <h1>develop\component\toolBar\toolBar.js <small>File</small></h1>
</div>

<div class="file">
    <pre class="prettyprint linenums" id='src_code'>
/**
 * @module component
 */
/**
 * 工具条模块
 * @class toolBar
 * @static
 */
require(&quot;./toolBar.css&quot;);
var toolBar = require(&quot;./toolBar.html&quot;);
var selectResult = require(&quot;./selectResult.html&quot;);
module.exports = {
    init: init
};
function init(instance,config) {
    config=config||{};
    var dom = instance.document;
    var scene = instance.scene;
    var wrap = $(dom).find(&quot;.qtopo-toolBar&quot;);
    if (wrap.length == 0) {
        wrap = $(&quot;&lt;div class=&#x27;qtopo-toolBar&#x27;&gt;&lt;/div&gt;&quot;);
        $(dom).append(wrap);
    }
    toolBar = $(toolBar);
    editBar = toolBar.find(&quot;.edit-children&quot;);
    selectResult = $(selectResult).hide();
    wrap.append(toolBar);
    wrap.append(selectResult);
    wrap.find(&quot;[data-toggle*=&#x27;tooltip&#x27;]&quot;).tooltip();//开启提示框
    //切换模式和子菜单栏显示位置
    wrap.find(&quot;[name=topo_mode]&quot;).click(function (e) {
        var mode = $(this).find(&quot;input&quot;).val();
        scene.setMode(mode);
        if (mode == &quot;normal&quot;) {
            editBar.show();
        } else {
            editBar.hide();
        }
    });
    /**
     * 调用scene.goCenter()缩放和居中展示
     * @property 居中展示
     */
    toolBar.find(&quot;button[name=center]&quot;).click(function () {
        scene.goCenter();
    });
    /**
     * 调用scene.resize(1)还原比例
     * @property 正常显示
     */
    toolBar.find(&quot;button[name=common]&quot;).click(function () {
        scene.resize(1);
    });
    /**
     * 调用scene.toggleZoom()开启鼠标缩放,操作鼠标滚轮放大和缩小图层
     * @property 鼠标缩放
     */
    toolBar.find(&quot;button[name=zoom_checkbox]&quot;).click(function () {
        scene.toggleZoom();
    });
    /**
     * 调用scene.toggleEagleEye()切换鹰眼
     * @property 鹰眼
     */
    toolBar.find(&quot;button[name=eagle_eye]&quot;).click(function () {
        scene.toggleEagleEye();
    });
    /**
     * 调用scene.getPicture()新窗口打开图层截图
     * @property 导出png
     */
    toolBar.find(&quot;button[name=export_image]&quot;).click(function () {
        scene.getPicture();
    });
    var doSave=function(e){
        var w = window.open(&#x27;about:blank&#x27;, &#x27;SaveData&#x27;);
        w.document.write(JSON.stringify(instance.toJson()));
    };
    toolBar.find(&quot;button[name=save]&quot;).click(function(e){
            doSave(e);
    });
    /**
     * 开启自动布局设置窗口,需要载入windows模块
     * @property 自动布局
     */
    editBar.find(&quot;button[name=auto_layout]&quot;).click(function () {
        if($.isFunction(instance.open)){
            instance.open(&quot;autoLayout&quot;);
        }else{
            QTopo.util.error(&quot;The autoLayout window need init windows conponent!&quot;);
        }
    });
    var addSearch = initSearchMode(instance, scene, toolBar, selectResult);
    if (!config.hideDefaultSearch) {
        addSearch({
            type: &quot;value&quot;,
            name: &quot;default&quot;,
            hideResult: false,
            search: function (val) {
                return scene.find(val, &quot;node&quot;)
                    .map(function (i) {
                        return {
                            content: i.attr.name,
                            target: i
                        }
                    });
            },
            clickResult: function (result) {
                if (result.target) {
                    scene.moveToNode(result.target);
                }
            }
        });
    }
    return {
        /**
         * 添加搜索模块
         * @method addSearch
         * @param searchMode {object|array} 搜索模块配置，可为配置集合
         *  @param searchMode.name 显示在选择框中的名称
         *  @param searchMode.type  唯一标识
         *  @param [searchMode.selected] 是否初始被选中
         *  @param [searchMode.search] 回车或点击搜索按钮时的事件处理,传入的参数为Input的输入值，返回参数content属性为结果面板中展示的内容
         *  @param [searchMode.hideResult] 是否启用结果面板
         *  @param [searchMode.clickResult] 结果面板被选中后的事件处理,传入的参数为search的结果
         *  @example
         *      instance.setComponent({
                    toolBar: {
                        addSearch:[
                            {   //自定义的搜索配置，该搜索不调用预定义的任何事件
                                //自定义了额外面板展示,工具条上条目仅用来触发额外的搜索面板
                                type:&quot;deviceType&quot;,
                                name:&quot;设备型号&quot;,
                                hideResult:true
                            },
                            {//默认的搜索模块配置,可以初始化时 hideDefaultSearch: true禁止加载
                               type: &quot;value&quot;,
                               name: &quot;default&quot;,
                               hideResult: false,
                               search: function (val) {//val值为Input内容
                                   return scene.find(val, &quot;node&quot;)
                                       .map(function (i) {
                                           return {
                                               content: i.attr.name,//该属性用以展示文字
                                               target: i //自定义
                                           }
                                       });
                               },
                               clickResult: function (result) {
                                   if (result.target) {//此处target为search结果中设置，content属性被用以展示文字
                                       scene.moveToNode(result.target);
                                   }
                               }
                           }
                        ]
         */
        addSearch: addSearch,
        /**
         * 配置点击保存按钮时事件处理,重复设置会替换上次设置
         *
         * 默认动作为序列化当前图层信息并打开新页面展示
         * @method save
         * @param fn {function}
         * @example
         *       instance.setComponent({
                    toolBar: {
                         save: function (e) {//e事件对象
                                ...
                         }
                    }
             })
         */
        save: function(fn) {
            if ($.isFunction(fn)) {
                doSave=fn;
            }
        }
    };
}

/*
 * 添加搜索模块
 * @param instance
 * @param scene
 * @param toolBar
 * @param resultWin 搜索结果展示区
 * @returns {Function}返回添加搜索方式的接口
 */
function initSearchMode(instance, scene, toolBar, resultWin) {
    var resultSelect = resultWin.find(&quot;.result-select&quot;);
    var resultShow = resultWin.find(&quot;.result-show&quot;);
    var selectWin = toolBar.find(&quot;select[name=search_mode]&quot;);
    var searchBtn = toolBar.find(&quot;button[name=search]&quot;);
    var input = toolBar.find(&quot;input[name=search_value]&quot;);
    var clear = toolBar.find(&quot;.clear-input&quot;);
    var inputGroup = toolBar.find(&quot;.t-search-input&quot;);
    selectWin.data(&quot;searchMode&quot;, {});
    clear.hide();
    clear.click(function () {
        input.val(&quot;&quot;);
        clear.hide();
        resultWin.hide();
    });
    selectWin.change(function () {
        showGroup();
        clear.click();
    });
    input.keydown(function (e) {
        if (e.keyCode == 13) {
            doSearch();
        }
        clear.show();
    });
    searchBtn.click(function () {
        doSearch();
    });
    resultSelect.click(function () {
        resultShow.toggle();
    });
    resultShow.click(function (e) {
        if (e.target) {
            $(e.target).data(&quot;doResult&quot;)();
        }
    });
    resultShow.on(&#x27;mouseleave&#x27;, function (e) {
        e.stopPropagation();
        resultShow.hide();
    });
    function doSearch() {
        resultWin.hide();
        var searchConfig = selectWin.data(&quot;searchMode&quot;)[selectWin.val()];
        if ($.isFunction(searchConfig.search)) {
            var results = searchConfig.search(input.val());
            if (!searchConfig.hideResult) {
                addResult(results, searchConfig.clickResult,searchConfig.ajaxData);
            }
        }
    }

    function addResult(results, click,ajaxData) {
        if ($.isArray(results)) {
            appendResultArr(results);
        } else if(typeof results !=&#x27;undefined&#x27;&amp;&amp; $.isFunction(results.state)&amp;&amp;$.isFunction(ajaxData)){//为deferred对象
            results.done(function(data){
                data=ajaxData(data);
                if($.isArray(data)){
                    appendResultArr(data);
                }else{
                    QTopo.util.error(&quot;searchResult error ,should be Array :&quot;+arr);
                }
            });
        }

        function appendResultArr(results){
            if(results.length &gt; 0){
                resultShow.empty();
                $.each(results, function (i, result) {
                    var li = $(&quot;&lt;li title=&#x27;&quot; + result.content + &quot;&#x27;&gt;&quot; + result.content + &quot;&lt;/li&gt;&quot;)
                        .data(&#x27;doResult&#x27;, function () {
                            if ($.isFunction(click)) {
                                click(result);
                            }
                        });
                    resultShow.append(li);
                });
                resultWin.show();
            }else{
                instance.open(&quot;view&quot;, {
                    content: &quot;无查询结果!&quot;,
                    width: 200
                });
            }
        }
    }
    var showTime;
    function showGroup() {
        clear.attr(&quot;style&quot;,&quot;opacity: 1&quot;);
        selectWin.attr(&quot;style&quot;,&quot;display: block&quot;);
        input.attr(&quot;style&quot;,&quot;display: block&quot;);
        inputGroup.attr(&quot;style&quot;,&quot;width: 180px&quot;);
        if(showTime){
            clearTimeout(showTime);
        }
        showTime=setTimeout(function () {
            clear.attr(&quot;style&quot;,&quot;&quot;);
            selectWin.attr(&quot;style&quot;,&quot;&quot;);
            input.attr(&quot;style&quot;,&quot;&quot;);
            inputGroup.attr(&quot;style&quot;,&quot;&quot;);
        },3000);
    }

    return function (search) {
        if ($.isArray(search)) {
            search.map(function (i) {
                addSearch(i);
            });
        } else {
            addSearch(search);
        }

        return instance;
        function addSearch(config) {
            if (config) {
                selectWin.data(&quot;searchMode&quot;)[config.type] = config;
                selectWin.prepend(&quot;&lt;option value=&#x27;&quot; + config.type + &quot;&#x27; &quot; + (config.selected ? &#x27;selected&#x27; : &#x27;&#x27;) + &quot;&gt;&quot; + config.name || config.type + &quot;&lt;/option&gt;&quot;);
            }
        }
    }
}
    </pre>
</div>

                </div>
            </div>
        </div>
    </div>
<a id="gotoTop" class='well well-small' href='#'>
    Top
</a>
<script src="../assets/vendor/jquery/jquery-1.8.2.min.js"></script>
<script src="../assets/vendor/bootstrap/js/bootstrap.min.js"></script>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script src="../assets/js/config.js"></script>
<script src="../assets/js/doc.js"></script>
</body>
</html>
